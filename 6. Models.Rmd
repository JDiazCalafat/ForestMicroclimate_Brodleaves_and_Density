---
title: "Models"
author: "Joan Diaz Calafat"
date: "1/10/2022"
output: pdf_document
---

Load packages:

```{r}
library(lubridate)
library(gamm4)
library(dplyr)
library(gamm4)
library(RColorBrewer)
```


Load data:

```{r}
tree.temp <- read.csv("./DATASETS/tree_temp.csv", header = TRUE)
```

Calculate month:

```{r}
tree.temp$month <- month(tree.temp$Date)
```

Remove all column variables for data between 10 and 20 m raius:

```{r}
tree.temp <- tree.temp[,which(colnames(tree.temp) %in% c("site", "Plot", "Date", "location", "month", "Temp.mean", "Temp.min", "Temp.max", "era5_air", "era5_air", "era5_max", "era5_min", "era5_soil", "air_off", "min_off", "max_off", "soil_off", "Basal_Area_20m", "Basal_Area_19m", "Basal_Area_18m", "Basal_Area_17m", "Basal_Area_16m", "Basal_Area_15m", "Basal_Area_14m", "Basal_Area_13m" ,"Basal_Area_12m", "Basal_Area_11m", "Basal_Area_10m", "Basal_Area_9m", "Basal_Area_8m", "Basal_Area_7m", "Basal_Area_6m", "Basal_Area_5m", "Basal_Area_4m", "nci20m", "nci19m", "nci18m", "nci17m", "nci16m", "nci15m", "nci14m", "nci13m", "nci12m", "nci11m", "nci10m", "nci9m", "nci8m", "nci7m", "nci6m", "nci5m","nci4m","CanOpen", "prev_av_temp", "wind", "perc_broad_20m", "perc_broad_19m", "perc_broad_18m", "perc_broad_17m", "perc_broad_16m", "perc_broad_15m", "perc_broad_14m", "perc_broad_13m", "perc_broad_12m", "perc_broad_11m", "perc_broad_10m", "perc_broad_9m", "perc_broad_8m", "perc_broad_7m", "perc_broad_6m", "perc_broad_5m", "perc_broad_4m", "snow", "prev_av_prec"))]
```

Separate air and soil loggers:

```{r}
tree.temp.a <- tree.temp[which(tree.temp$location == "a"),]
tree.temp.s <- tree.temp[which(tree.temp$location == "s"),]
```

And Warmest and coldest month:

```{r}
tree.temp.a.jul <- tree.temp.a[which(tree.temp.a$month == 7),]
tree.temp.a.jan <- tree.temp.a[which(tree.temp.a$month == 1),]

tree.temp.s.jul <- tree.temp.s[which(tree.temp.s$month == 7),]
tree.temp.s.jan <- tree.temp.s[which(tree.temp.s$month == 1),]
```


# Models:

## Soil models:

### Only linear, with and without interaction:

```{r}
tree.temp.s.jul$Day <- day(tree.temp.s.jul$Date)
tree.temp.s.jan$Day <- day(tree.temp.s.jan$Date)

# Canopy openness as a proxy for forest density
model.soil.jul.co.lininteract <- gamm4(soil_off ~ CanOpen*perc_broad_20m + site + s(Day), random = ~ (1|site:Plot), data = tree.temp.s.jul)

summary(model.soil.jul.co.lininteract$gam)
AIC(model.soil.jul.co.lininteract$mer)

model.soil.jul.co.linadd <- gamm4(soil_off ~ CanOpen + perc_broad_20m + site + s(Day), random = ~ (1|site:Plot), data = tree.temp.s.jul)

summary(model.soil.jul.co.linadd$gam)
AIC(model.soil.jul.co.linadd$mer)

model.soil.jan.co.lininteract <- gamm4(soil_off ~ CanOpen*perc_broad_20m + site + s(Day), random = ~ (1|site:Plot), data = tree.temp.s.jan)

summary(model.soil.jan.co.lininteract$gam)
AIC(model.soil.jan.co.lininteract$mer)

model.soil.jan.co.linadd <- gamm4(soil_off ~ CanOpen + perc_broad_20m + site + s(Day), random = ~ (1|site:Plot), data = tree.temp.s.jan)

summary(model.soil.jan.co.linadd$gam)
AIC(model.soil.jan.co.linadd$mer)


# Basal area as a proxy for forest density

model.soil.jul.ba.lininteract <- gamm4(soil_off ~ Basal_Area_20m*perc_broad_20m + site + s(Day), random = ~ (1|site:Plot), data = tree.temp.s.jul)

summary(model.soil.jul.ba.lininteract$gam)
AIC(model.soil.jul.ba.lininteract$mer)

model.soil.jul.ba.linadd <- gamm4(soil_off ~ Basal_Area_20m + perc_broad_20m + site + s(Day), random = ~ (1|site:Plot), data = tree.temp.s.jul)

summary(model.soil.jul.ba.linadd$gam)
AIC(model.soil.jul.ba.linadd$mer)

model.soil.jan.ba.lininteract <- gamm4(soil_off ~ Basal_Area_20m*perc_broad_20m + site + s(Day), random = ~ (1|site:Plot), data = tree.temp.s.jan)

summary(model.soil.jan.ba.lininteract$gam)
AIC(model.soil.jan.ba.lininteract$mer)

model.soil.jan.ba.linadd <- gamm4(soil_off ~ Basal_Area_20m + perc_broad_20m + site + s(Day), random = ~ (1|site:Plot), data = tree.temp.s.jan)

summary(model.soil.jan.ba.linadd$gam)
AIC(model.soil.jan.ba.linadd$mer)
```

### With different smoother terms configuration:

```{r}
tree.temp.s.jan$site <- as.factor(tree.temp.s.jan$site)
tree.temp.s.jul$site <- as.factor(tree.temp.s.jul$site)

# Warmest month + canopy openness:
soilmodel1 <- gamm4(soil_off ~ s(CanOpen,perc_broad_20m) + s(Day), random = ~ (1|site:Plot), data = tree.temp.s.jul)

summary(soilmodel1$gam)
AIC(soilmodel1$mer)

soilmodel2 <- gamm4(soil_off ~ s(CanOpen,perc_broad_20m) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.s.jul)

summary(soilmodel2$gam)
AIC(soilmodel2$mer)

soilmodel3 <- gamm4(soil_off ~ s(CanOpen) + s(perc_broad_20m) + s(Day), random = ~ (1|site:Plot), data = tree.temp.s.jul)

summary(soilmodel3$gam)
AIC(soilmodel3$mer)

soilmodel4 <- gamm4(soil_off ~ s(CanOpen) + s(perc_broad_20m) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.s.jul)

summary(soilmodel4$gam)
AIC(soilmodel4$mer)

soilmodel5 <- gamm4(soil_off ~ s(CanOpen, perc_broad_20m, by = site) + s(Day), random = ~ (1|site:Plot), data = tree.temp.s.jul)

summary(soilmodel5$gam)
AIC(soilmodel5$mer)

soilmodel6 <- gamm4(soil_off ~ s(CanOpen, perc_broad_20m, by = site) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.s.jul)

summary(soilmodel6$gam)
AIC(soilmodel6$mer)

# Coldest month + canopy openness:
soilmodel7 <- gamm4(soil_off ~ s(CanOpen,perc_broad_20m) + s(Day), random = ~ (1|site:Plot), data = tree.temp.s.jan)

summary(soilmodel7$gam)
AIC(soilmodel7$mer)

soilmodel8 <- gamm4(soil_off ~ s(CanOpen,perc_broad_20m) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.s.jan)

summary(soilmodel8$gam)
AIC(soilmodel8$mer)

soilmodel9 <- gamm4(soil_off ~ s(CanOpen) + s(perc_broad_20m) + s(Day), random = ~ (1|site:Plot), data = tree.temp.s.jan)

summary(soilmodel9$gam)
AIC(soilmodel9$mer)

soilmodel10 <- gamm4(soil_off ~ s(CanOpen) + s(perc_broad_20m) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.s.jan)

summary(soilmodel10$gam)
AIC(soilmodel10$mer)

soilmodel11 <- gamm4(soil_off ~ s(CanOpen, perc_broad_20m, by = site) + s(Day), random = ~ (1|site:Plot), data = tree.temp.s.jan)

summary(soilmodel11$gam)
AIC(soilmodel11$mer)

soilmodel12 <- gamm4(soil_off ~ s(CanOpen, perc_broad_20m, by = site) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.s.jan)

summary(soilmodel12$gam)
AIC(soilmodel12$mer)

# Warmest month + basal area:
soilmodel13 <- gamm4(soil_off ~ s(Basal_Area_20m,perc_broad_20m) + s(Day), random = ~ (1|site:Plot), data = tree.temp.s.jul)

summary(soilmodel13$gam)
AIC(soilmodel13$mer)

soilmodel14 <- gamm4(soil_off ~ s(Basal_Area_20m,perc_broad_20m) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.s.jul)

summary(soilmodel14$gam)
AIC(soilmodel14$mer)

soilmodel15 <- gamm4(soil_off ~ s(Basal_Area_20m) + s(perc_broad_20m) + s(Day), random = ~ (1|site:Plot), data = tree.temp.s.jul)

summary(soilmodel15$gam)
AIC(soilmodel15$mer)

soilmodel16 <- gamm4(soil_off ~ s(Basal_Area_20m) + s(perc_broad_20m) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.s.jul)

summary(soilmodel16$gam)
AIC(soilmodel16$mer)

soilmodel17 <- gamm4(soil_off ~ s(Basal_Area_20m, perc_broad_20m, by = site) + s(Day), random = ~ (1|site:Plot), data = tree.temp.s.jul)

summary(soilmodel17$gam)
AIC(soilmodel17$mer)

soilmodel18 <- gamm4(soil_off ~ s(Basal_Area_20m, perc_broad_20m, by = site) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.s.jul)

summary(soilmodel18$gam)
AIC(soilmodel18$mer)

# Coldest month + basal area:
soilmodel19 <- gamm4(soil_off ~ s(Basal_Area_20m,perc_broad_20m) + s(Day), random = ~ (1|site:Plot), data = tree.temp.s.jan)

summary(soilmodel19$gam)
AIC(soilmodel19$mer)

soilmodel20 <- gamm4(soil_off ~ s(Basal_Area_20m,perc_broad_20m) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.s.jan)

summary(soilmodel20$gam)
AIC(soilmodel20$mer)

soilmodel21 <- gamm4(soil_off ~ s(Basal_Area_20m) + s(perc_broad_20m) + s(Day), random = ~ (1|site:Plot), data = tree.temp.s.jan)

summary(soilmodel21$gam)
AIC(soilmodel21$mer)

soilmodel22 <- gamm4(soil_off ~ s(Basal_Area_20m) + s(perc_broad_20m) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.s.jan)

summary(soilmodel22$gam)
AIC(soilmodel22$mer)

soilmodel23 <- gamm4(soil_off ~ s(Basal_Area_20m, perc_broad_20m, by = site) + s(Day), random = ~ (1|site:Plot), data = tree.temp.s.jan)

summary(soilmodel23$gam)
AIC(soilmodel23$mer)

soilmodel24 <- gamm4(soil_off ~ s(Basal_Area_20m, perc_broad_20m, by = site) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.s.jan)

summary(soilmodel24$gam)
AIC(soilmodel24$mer)
```

### Adding covariates:

First we should check for correlation between our covariates:

```{r}
library(corrplot)

# soil temp in January

cor.s.jan <- cor(tree.temp.s.jan[,which(colnames(tree.temp.s.jan) %in% c("wind", "snow", "prev_av_temp", "prev_av_prec", "CanOpen", "nci20m", "perc_broad_20m", "Basal_Area_20m"))])

corrplot(cor.s.jan, method = 'ellipse', order = 'AOE', type = 'upper', addCoef.col ='black', number.cex = 0.5)

# soil temp in July - removing snow covariate

cor.s.jul <- cor(tree.temp.s.jul[,which(colnames(tree.temp.s.jul) %in% c("wind", "prev_av_temp", "prev_av_prec", "CanOpen", "nci20m", "perc_broad_20m", "Basal_Area_20m"))])

corrplot(cor.s.jul, method = 'ellipse', order = 'AOE', type = 'upper', addCoef.col ='black', number.cex = 0.5)

```

No variables are excessively correlated. Only NCI and Basal Area, as they are based on the same data for their calculation. However, only one variable (among Canopy Openness [CanOpen], NCI and Basal area) is included in the analyses as a proxy for forest density, within the smoother term of the GLMM.

Now the models: we will add previous averaged temperature and snow covariates.

#### Model with covariates for the soil temperature offset in the coldest month:

We will add Day within a single smoother to account for temporal autocorrelation.

```{r}
# basal area
model.soil.jan.ba.all <- gamm4(soil_off ~ s(Basal_Area_20m,perc_broad_20m) + s(Day) + site + snow + prev_av_temp, random = ~ (1|site:Plot), data = tree.temp.s.jan)

summary(model.soil.jan.ba.all$gam)
AIC(model.soil.jan.ba.all$mer)

#canopy openness
model.soil.jan.co.all <- gamm4(soil_off ~ s(CanOpen,perc_broad_20m) + s(Day) + site + snow + prev_av_temp, random = ~ (1|site:Plot), data = tree.temp.s.jan)

summary(model.soil.jan.co.all$gam)
AIC(model.soil.jan.co.all$mer)

colfunc <- colorRampPalette(c("#579dc8", "#ffff73", "#fb2e0e")) # create a color palette to be used as a heatmap

# basal area
plot(model.soil.jan.ba.all$gam, scheme = 2, lwd = 3, main = "Average soil temp offset coldest month", xlab = "Basal area", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select =1)

points(tree.temp$Basal_Area_20m, tree.temp$perc_broad_20m, pch = 4, cex = 1)

# canopy openness

plot(model.soil.jan.co.all$gam, scheme = 2, lwd = 3, main = "Average soil temp offset coldest month", xlab = "Canopy openness", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select =1)

points(tree.temp$CanOpen, tree.temp$perc_broad_20m, pch = 4, cex = 1)


# model residuals
gam.check(model.soil.jan.ba.all$gam)
gam.check(model.soil.jan.co.all$gam)

```

#### Model with covariates for the soil temperature offset in the warmest month

Same approach:

```{r}
# basal area
model.soil.jul.ba.all <- gamm4(soil_off ~ s(Basal_Area_20m,perc_broad_20m) + s(Day) + site + prev_av_temp, random = ~ (1|site:Plot), data = tree.temp.s.jul)

summary(model.soil.jul.ba.all$gam)
AIC(model.soil.jul.ba.all$mer)

# canopy openness
model.soil.jul.co.all <- gamm4(soil_off ~ s(CanOpen,perc_broad_20m) + s(Day) + site + prev_av_temp, random = ~ (1|site:Plot), data = tree.temp.s.jul)

summary(model.soil.jul.co.all$gam)
AIC(model.soil.jul.co.all$mer)

# All covariates are significant. None should be removed.

# basal area

plot(model.soil.jul.ba.all$gam, scheme = 2, lwd = 3, main = "Average soil temp offset warmest month", xlab = "Basal area", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select =1)

points(tree.temp$Basal_Area_20m, tree.temp$perc_broad_20m, pch = 4, cex = 1)

# canopy openness

plot(model.soil.jul.co.all$gam, scheme = 2, lwd = 3, main = "Average soil temp offset warmest month", xlab = "Canopy openness", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select =1)

points(tree.temp$CanOpen, tree.temp$perc_broad_20m, pch = 4, cex = 1)

# model residuals:
gam.check(model.soil.jul.ba.all$gam)
gam.check(model.soil.jul.co.all$gam)
```
The relationship between forest density and proportion of broadleaves seems pretty linear. In fact, when using unidimensional separate smoothers, AIC only grows by _ca._ 1 point.

*Is something going on with the model residuals?* _Check!_

## Air loggers:

### Only linear, with and without interaction:

```{r}
tree.temp.a.jul$Day <- day(tree.temp.a.jul$Date)
tree.temp.a.jan$Day <- day(tree.temp.a.jan$Date)

# Canopy openness as a proxy for forest density

model.air.jul.co.lininteract <- gamm4(air_off ~ CanOpen*perc_broad_20m + site + s(Day), random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.air.jul.co.lininteract$gam)
AIC(model.air.jul.co.lininteract$mer)

model.air.jul.co.linadd <- gamm4(air_off ~ CanOpen + perc_broad_20m + site + s(Day), random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.air.jul.co.linadd$gam)
AIC(model.air.jul.co.linadd$mer)

model.air.jan.co.lininteract <- gamm4(air_off ~ CanOpen*perc_broad_20m + site + s(Day), random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.air.jan.co.lininteract$gam)
AIC(model.air.jan.co.lininteract$mer)

model.air.jan.co.linadd <- gamm4(air_off ~ CanOpen + perc_broad_20m + site + s(Day), random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.air.jan.co.linadd$gam)
AIC(model.air.jan.co.linadd$mer)


# Basal area as a proxy for forest density

model.air.jul.ba.lininteract <- gamm4(air_off ~ Basal_Area_20m*perc_broad_20m + site + s(Day), random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.air.jul.ba.lininteract$gam)
AIC(model.air.jul.ba.lininteract$mer)

model.air.jul.ba.linadd <- gamm4(air_off ~ Basal_Area_20m + perc_broad_20m + site + s(Day), random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.air.jul.ba.linadd$gam)
AIC(model.air.jul.ba.linadd$mer)

model.air.jan.ba.lininteract <- gamm4(air_off ~ Basal_Area_20m*perc_broad_20m + site + s(Day), random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.air.jan.ba.lininteract$gam)
AIC(model.air.jan.ba.lininteract$mer)

model.air.jan.ba.linadd <- gamm4(air_off ~ Basal_Area_20m + perc_broad_20m + site + s(Day), random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.air.jan.ba.linadd$gam)
AIC(model.air.jan.ba.linadd$mer)
```

### Different smoother configurations

```{r}
tree.temp.a.jan$site <- as.factor(tree.temp.a.jan$site)
tree.temp.a.jul$site <- as.factor(tree.temp.a.jul$site)

# Warmest month + canopy openness:
airmodel1 <- gamm4(air_off ~ s(CanOpen,perc_broad_20m) + s(Day), random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(airmodel1$gam)
AIC(airmodel1$mer)

airmodel2 <- gamm4(air_off ~ s(CanOpen,perc_broad_20m) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(airmodel2$gam)
AIC(airmodel2$mer)

airmodel3 <- gamm4(air_off ~ s(CanOpen) + s(perc_broad_20m) + s(Day), random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(airmodel3$gam)
AIC(airmodel3$mer)

airmodel4 <- gamm4(air_off ~ s(CanOpen) + s(perc_broad_20m) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(airmodel4$gam)
AIC(airmodel4$mer)

airmodel5 <- gamm4(air_off ~ s(CanOpen, perc_broad_20m, by = site) + s(Day), random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(airmodel5$gam)
AIC(airmodel5$mer)

airmodel6 <- gamm4(air_off ~ s(CanOpen, perc_broad_20m, by = site) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(airmodel6$gam)
AIC(airmodel6$mer)

# Coldest month + canopy openness:
airmodel7 <- gamm4(air_off ~ s(CanOpen,perc_broad_20m) + s(Day), random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(airmodel7$gam)
AIC(airmodel7$mer)

airmodel8 <- gamm4(air_off ~ s(CanOpen,perc_broad_20m) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(airmodel8$gam)
AIC(airmodel8$mer)

airmodel9 <- gamm4(air_off ~ s(CanOpen) + s(perc_broad_20m) + s(Day), random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(airmodel9$gam)
AIC(airmodel9$mer)

airmodel10 <- gamm4(air_off ~ s(CanOpen) + s(perc_broad_20m) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(airmodel10$gam)
AIC(airmodel10$mer)

airmodel11 <- gamm4(air_off ~ s(CanOpen, perc_broad_20m, by = site) + s(Day), random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(airmodel11$gam)
AIC(airmodel11$mer)

airmodel12 <- gamm4(air_off ~ s(CanOpen, perc_broad_20m, by = site) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(airmodel12$gam)
AIC(airmodel12$mer)

# Warmest month + basal area:
airmodel13 <- gamm4(air_off ~ s(Basal_Area_20m,perc_broad_20m) + s(Day), random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(airmodel13$gam)
AIC(airmodel13$mer)

airmodel14 <- gamm4(air_off ~ s(Basal_Area_20m,perc_broad_20m) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(airmodel14$gam)
AIC(airmodel14$mer)

airmodel15 <- gamm4(air_off ~ s(Basal_Area_20m) + s(perc_broad_20m) + s(Day), random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(airmodel15$gam)
AIC(airmodel15$mer)

airmodel16 <- gamm4(air_off ~ s(Basal_Area_20m) + s(perc_broad_20m) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(airmodel16$gam)
AIC(airmodel16$mer)

airmodel17 <- gamm4(air_off ~ s(Basal_Area_20m, perc_broad_20m, by = site) + s(Day), random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(airmodel17$gam)
AIC(airmodel17$mer)

airmodel18 <- gamm4(air_off ~ s(Basal_Area_20m, perc_broad_20m, by = site) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(airmodel18$gam)
AIC(airmodel18$mer)

# Coldest month + basal area:
airmodel19 <- gamm4(air_off ~ s(Basal_Area_20m,perc_broad_20m) + s(Day), random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(airmodel19$gam)
AIC(airmodel19$mer)

airmodel20 <- gamm4(air_off ~ s(Basal_Area_20m,perc_broad_20m) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(airmodel20$gam)
AIC(airmodel20$mer)

airmodel21 <- gamm4(air_off ~ s(Basal_Area_20m) + s(perc_broad_20m) + s(Day), random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(airmodel21$gam)
AIC(airmodel21$mer)

airmodel22 <- gamm4(air_off ~ s(Basal_Area_20m) + s(perc_broad_20m) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(airmodel22$gam)
AIC(airmodel22$mer)

airmodel23 <- gamm4(air_off ~ s(Basal_Area_20m, perc_broad_20m, by = site) + s(Day), random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(airmodel23$gam)
AIC(airmodel23$mer)

airmodel24 <- gamm4(air_off ~ s(Basal_Area_20m, perc_broad_20m, by = site) + s(Day) + site, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(airmodel24$gam)
AIC(airmodel24$mer)
```

### Adding covariates:

For this, we will add all covariates but snow and then remove them according to their p-value.

#### Coldest month (with covariates)

* Minimum temperature offset:

```{r}
# basal area
model.minair.jan.ba.all <- gamm4(min_off ~ s(Basal_Area_20m,perc_broad_20m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.minair.jan.ba.all$gam)
AIC(model.minair.jan.ba.all$mer)


# canopy openness
model.minair.jan.co.all <- gamm4(min_off ~ s(CanOpen,perc_broad_20m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.minair.jan.co.all$gam)
AIC(model.minair.jan.co.all$mer)


# basal area

plot(model.minair.jan.ba.all$gam, scheme = 2, lwd = 3, main = "Min air temp offset coldest month", xlab = "Basal area", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$Basal_Area_20m, tree.temp$perc_broad_20m, pch = 4, cex = 1)

# canopy openness

plot(model.minair.jan.co.all$gam, scheme = 2, lwd = 3, main = "Min air temp offset coldest month", xlab = "Canopy openness", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$CanOpen, tree.temp$perc_broad_20m, pch = 4, cex = 1)

# model residuals
gam.check(model.minair.jan.ba.all$gam)
gam.check(model.minair.jan.co.all$gam)
```
* Mean temperature offset:

```{r}
# basal area
model.meanair.jan.ba.all <- gamm4(air_off ~ s(Basal_Area_20m,perc_broad_20m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.meanair.jan.ba.all$gam)
AIC(model.meanair.jan.ba.all$mer)


plot(model.meanair.jan.ba.all$gam, scheme = 2, lwd = 3, main = "Mean air temp offset coldest month", xlab = "Basal area", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$Basal_Area_20m, tree.temp$perc_broad_20m, pch = 4, cex = 1)

# model residuals
gam.check(model.meanair.jan.ba.all$gam)

# canopy openness

model.meanair.jan.co.all <- gamm4(air_off ~ s(CanOpen,perc_broad_20m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.meanair.jan.co.all$gam)
AIC(model.meanair.jan.co.all$mer)


plot(model.meanair.jan.co.all$gam, scheme = 2, lwd = 3, main = "Mean air temp offset coldest month", xlab = "Canopy openness", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$CanOpen, tree.temp$perc_broad_20m, pch = 4, cex = 1)

# model residuals
gam.check(model.meanair.jan.co.all$gam)
```

* Max temperature offset:

```{r}
# basal area
model.maxair.jan.ba.all <- gamm4(max_off ~ s(Basal_Area_20m,perc_broad_20m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.maxair.jan.ba.all$gam)
AIC(model.maxair.jan.ba.all$mer)


plot(model.maxair.jan.ba.all$gam, scheme = 2, lwd = 3, main = "Max air temp offset coldest month", xlab = "Basal area", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$Basal_Area_20m, tree.temp$perc_broad_20m, pch = 4, cex = 1)

# model residuals
gam.check(model.maxair.jan.ba.all$gam)

# canopy openness
model.maxair.jan.co.all <- gamm4(max_off ~ s(CanOpen,perc_broad_20m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.maxair.jan.co.all$gam)
AIC(model.maxair.jan.co.all$mer)


plot(model.maxair.jan.co.all$gam, scheme = 2, lwd = 3, main = "Max air temp offset coldest month", xlab = "Canopy openness", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$CanOpen, tree.temp$perc_broad_20m, pch = 4, cex = 1)

# model residuals
gam.check(model.maxair.jan.co.all$gam)
```
#### Warmest month (with covariates)

* Minimum temperature offset:

```{r}
# basal area
model.minair.jul.ba.all <- gamm4(min_off ~ s(Basal_Area_20m,perc_broad_20m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.minair.jul.ba.all$gam)
AIC(model.minair.jul.ba.all$mer)

plot(model.minair.jul.ba.all$gam, scheme = 2, lwd = 3, main = "Min air temp offset warmest month", xlab = "Basal area", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$Basal_Area_20m, tree.temp$perc_broad_20m, pch = 4, cex = 1)

# model residuals
gam.check(model.minair.jul.ba.all$gam)

# canopy openness
model.minair.jul.co.all <- gamm4(min_off ~ s(CanOpen,perc_broad_20m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.minair.jul.co.all$gam)
AIC(model.minair.jul.co.all$mer)

plot(model.minair.jul.co.all$gam, scheme = 2, lwd = 3, main = "Min air temp offset warmest month", xlab = "Canopy openness", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$CanOpen, tree.temp$perc_broad_20m, pch = 4, cex = 1)

# model residuals
gam.check(model.minair.jul.co.all$gam)
```

* Mean temperature offset

```{r}
# basal area
model.meanair.jul.ba.all <- gamm4(air_off ~ s(Basal_Area_20m,perc_broad_20m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.meanair.jul.ba.all$gam)
AIC(model.meanair.jul.ba.all$mer)

plot(model.meanair.jul.ba.all$gam, scheme = 2, lwd = 3, main = "Mean air temp offset warmest month", xlab = "Basal area", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$Basal_Area_20m, tree.temp$perc_broad_20m, pch = 4, cex = 1)

# model residuals
gam.check(model.meanair.jul.ba.all$gam)

# canopy openness
model.meanair.jul.co.all <- gamm4(air_off ~ s(CanOpen,perc_broad_20m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.meanair.jul.co.all$gam)
AIC(model.meanair.jul.co.all$mer)

plot(model.meanair.jul.co.all$gam, scheme = 2, lwd = 3, main = "Mean air temp offset warmest month", xlab = "Canopy openness", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$CanOpen, tree.temp$perc_broad_20m, pch = 4, cex = 1)

# model residuals
gam.check(model.meanair.jul.co.all$gam)
```

* Maximum temperature offset

```{r}
# basal area
model.maxair.jul.ba.all <- gamm4(max_off ~ s(Basal_Area_20m,perc_broad_20m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.maxair.jul.ba.all$gam)
AIC(model.maxair.jul.ba.all$mer)

plot(model.maxair.jul.ba.all$gam, scheme = 2, lwd = 3, main = "Max air temp offset warmest month", xlab = "Basal Area", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

# model residuals
gam.check(model.maxair.jul.ba.all$gam)

# canopy openness
model.maxair.jul.co.all <- gamm4(max_off ~ s(CanOpen,perc_broad_20m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.maxair.jul.co.all$gam)
AIC(model.maxair.jul.co.all$mer)


plot(model.maxair.jul.co.all$gam, scheme = 2, lwd = 3, main = "Max air temp offset warmest month", xlab = "Canopy openness", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$CanOpen, tree.temp$perc_broad_20m, pch = 4, cex = 1)

# model residuals
gam.check(model.maxair.jul.co.noprevtemp$gam)
```

### Put together all the plots:

#### Soil

```{r}
# Basal area
par(mfrow=c(1,2))

plot(model.soil.jan.ba.all$gam, scheme = 2, lwd = 3, main = "Average soil temp offset coldest month", xlab = "Basal area", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 2, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select =1)

points(tree.temp$Basal_Area_20m, tree.temp$perc_broad_20m, pch = 4, cex = 1)

plot(model.soil.jul.ba.all$gam, scheme = 2, lwd = 3, main = "Average soil temp offset warmest month", xlab = "Basal area", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 2, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$Basal_Area_20m, tree.temp$perc_broad_20m, pch = 4, cex = 1)

# Canopy openness
par(mfrow=c(1,2))

plot(model.soil.jan.co.all$gam, scheme = 2, lwd = 3, main = "Average soil temp offset coldest month", xlab = "Canopy openness", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.5, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select =1)

points(tree.temp$CanOpen, tree.temp$perc_broad_20m, pch = 4, cex = 1)

plot(model.soil.jul.co.all$gam, scheme = 2, lwd = 3, main = "Average soil temp offset warmest month", xlab = "Canopy openness", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 2, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select =1)

points(tree.temp$CanOpen, tree.temp$perc_broad_20m, pch = 4, cex = 1)
```

#### Air

```{r}
# Basal area

par(mfrow=c(3,2))

plot(model.minair.jan.ba.all$gam, scheme = 2, lwd = 3, main = "Min air temp offset coldest month", xlab = "Basal area", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$Basal_Area_20m, tree.temp$perc_broad_20m, pch = 4, cex = 1)


plot(model.minair.jul.ba.all$gam, scheme = 2, lwd = 3, main = "Min air temp offset warmest month", xlab = "Basal area", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$Basal_Area_20m, tree.temp$perc_broad_20m, pch = 4, cex = 1)


plot(model.meanair.jan.ba.all$gam, scheme = 2, lwd = 3, main = "Mean air temp offset coldest month", xlab = "Basal area", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$Basal_Area_20m, tree.temp$perc_broad_20m, pch = 4, cex = 1)


plot(model.meanair.jul.ba.all$gam, scheme = 2, lwd = 3, main = "Mean air temp offset warmest month", xlab = "Basal area", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$Basal_Area_20m, tree.temp$perc_broad_20m, pch = 4, cex = 1)


plot(model.maxair.jan.ba.all$gam, scheme = 2, lwd = 3, main = "Max air temp offset coldest month", xlab = "Basal area", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$Basal_Area_20m, tree.temp$perc_broad_20m, pch = 4, cex = 1)


plot(model.maxair.jul.ba.all$gam, scheme = 2, lwd = 3, main = "Max air temp offset warmest month", xlab = "Basal Area", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$Basal_Area_20m, tree.temp$perc_broad_20m, pch = 4, cex = 1)

# Canopy openness

par(mfrow=c(3,2))

plot(model.minair.jan.co.all$gam, scheme = 2, lwd = 3, main = "Min air temp offset coldest month", xlab = "Canopy openness", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$CanOpen, tree.temp$perc_broad_20m, pch = 4, cex = 1)


plot(model.minair.jul.co.all$gam, scheme = 2, lwd = 3, main = "Min air temp offset warmest month", xlab = "Canopy openness", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$CanOpen, tree.temp$perc_broad_20m, pch = 4, cex = 1)


plot(model.meanair.jan.co.all$gam, scheme = 2, lwd = 3, main = "Mean air temp offset coldest month", xlab = "Canopy openness", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$CanOpen, tree.temp$perc_broad_20m, pch = 4, cex = 1)


plot(model.meanair.jul.co.all$gam, scheme = 2, lwd = 3, main = "Mean air temp offset warmest month", xlab = "Canopy openness", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$CanOpen, tree.temp$perc_broad_20m, pch = 4, cex = 1)


plot(model.maxair.jan.co.all$gam, scheme = 2, lwd = 3, main = "Max air temp offset coldest month", xlab = "Canopy openness", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$CanOpen, tree.temp$perc_broad_20m, pch = 4, cex = 1)

plot(model.maxair.jul.co.all$gam, scheme = 2, lwd = 3, main = "Max air temp offset warmest month", xlab = "Canopy openness", ylab = "Broadleaved component (%)", cex.lab = 1.5, labcex = 1.1, cex.main = 2, too.far = 0.2, rug=T, hcolor=colfunc(999), select = 1)

points(tree.temp$CanOpen, tree.temp$perc_broad_20m, pch = 4, cex = 1)

```

## BA at different radi:

```{r}

# Mean air temp offset warmest month

tree.temp.a.jul <- tree.temp.a.jul[-which(tree.temp.a.jul$site == "Arville"),]

model.meanair.jul.ba.10 <- gamm4(air_off ~ s(Basal_Area_10m,perc_broad_10m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.meanair.jul.ba.10$gam)
AIC(model.meanair.jul.ba.10$mer)

model.meanair.jul.ba.9 <- gamm4(air_off ~ s(Basal_Area_9m,perc_broad_9m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.meanair.jul.ba.9$gam)
AIC(model.meanair.jul.ba.9$mer)

model.meanair.jul.ba.8 <- gamm4(air_off ~ s(Basal_Area_8m,perc_broad_8m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.meanair.jul.ba.8$gam)
AIC(model.meanair.jul.ba.8$mer)

model.meanair.jul.ba.7 <- gamm4(air_off ~ s(Basal_Area_7m,perc_broad_7m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.meanair.jul.ba.7$gam)
AIC(model.meanair.jul.ba.7$mer)

model.meanair.jul.ba.6 <- gamm4(air_off ~ s(Basal_Area_6m,perc_broad_6m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.meanair.jul.ba.6$gam)
AIC(model.meanair.jul.ba.6$mer)

model.meanair.jul.ba.5 <- gamm4(air_off ~ s(Basal_Area_5m,perc_broad_5m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.meanair.jul.ba.5$gam)
AIC(model.meanair.jul.ba.5$mer)

model.meanair.jul.ba.4 <- gamm4(air_off ~ s(Basal_Area_4m,perc_broad_4m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.meanair.jul.ba.4$gam)
AIC(model.meanair.jul.ba.4$mer)

# Min air temperature offset warmest month
model.minair.jul.ba.10 <- gamm4(min_off ~ s(Basal_Area_10m,perc_broad_10m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.minair.jul.ba.10$gam)
AIC(model.minair.jul.ba.10$mer)

model.minair.jul.ba.9 <- gamm4(min_off ~ s(Basal_Area_9m,perc_broad_9m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.minair.jul.ba.9$gam)
AIC(model.minair.jul.ba.9$mer)

model.minair.jul.ba.8 <- gamm4(min_off ~ s(Basal_Area_8m,perc_broad_8m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.minair.jul.ba.8$gam)
AIC(model.minair.jul.ba.8$mer)

model.minair.jul.ba.7 <- gamm4(min_off ~ s(Basal_Area_7m,perc_broad_7m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.minair.jul.ba.7$gam)
AIC(model.minair.jul.ba.7$mer)

model.minair.jul.ba.6 <- gamm4(min_off ~ s(Basal_Area_6m,perc_broad_6m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.minair.jul.ba.6$gam)
AIC(model.minair.jul.ba.6$mer)

model.minair.jul.ba.5 <- gamm4(min_off ~ s(Basal_Area_5m,perc_broad_5m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.minair.jul.ba.5$gam)
AIC(model.minair.jul.ba.5$mer)

model.minair.jul.ba.4 <- gamm4(min_off ~ s(Basal_Area_4m,perc_broad_4m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.minair.jul.ba.4$gam)
AIC(model.minair.jul.ba.4$mer)

# Max air temperature offset warmest month
model.maxair.jul.ba.10 <- gamm4(max_off ~ s(Basal_Area_10m,perc_broad_10m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.maxair.jul.ba.10$gam)
AIC(model.maxair.jul.ba.10$mer)

model.maxair.jul.ba.9 <- gamm4(max_off ~ s(Basal_Area_9m,perc_broad_9m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.maxair.jul.ba.9$gam)
AIC(model.maxair.jul.ba.9$mer)

model.maxair.jul.ba.8 <- gamm4(max_off ~ s(Basal_Area_8m,perc_broad_8m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.maxair.jul.ba.8$gam)
AIC(model.maxair.jul.ba.8$mer)

model.maxair.jul.ba.7 <- gamm4(max_off ~ s(Basal_Area_7m,perc_broad_7m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.maxair.jul.ba.7$gam)
AIC(model.maxair.jul.ba.7$mer)

model.maxair.jul.ba.6 <- gamm4(max_off ~ s(Basal_Area_6m,perc_broad_6m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.maxair.jul.ba.6$gam)
AIC(model.maxair.jul.ba.6$mer)

model.maxair.jul.ba.5 <- gamm4(max_off ~ s(Basal_Area_5m,perc_broad_5m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.maxair.jul.ba.5$gam)
AIC(model.maxair.jul.ba.5$mer)

model.maxair.jul.ba.4 <- gamm4(max_off ~ s(Basal_Area_4m,perc_broad_4m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jul)

summary(model.maxair.jul.ba.4$gam)
AIC(model.maxair.jul.ba.4$mer)


# Mean air temp offset warmest month

tree.temp.a.jan <- tree.temp.a.jan[-which(tree.temp.a.jan$site == "Arville"),]

model.meanair.jan.ba.10 <- gamm4(air_off ~ s(Basal_Area_10m,perc_broad_10m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.meanair.jan.ba.10$gam)
AIC(model.meanair.jan.ba.10$mer)

model.meanair.jan.ba.9 <- gamm4(air_off ~ s(Basal_Area_9m,perc_broad_9m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.meanair.jan.ba.9$gam)
AIC(model.meanair.jan.ba.9$mer)

model.meanair.jan.ba.8 <- gamm4(air_off ~ s(Basal_Area_8m,perc_broad_8m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.meanair.jan.ba.8$gam)
AIC(model.meanair.jan.ba.8$mer)

model.meanair.jan.ba.7 <- gamm4(air_off ~ s(Basal_Area_7m,perc_broad_7m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.meanair.jan.ba.7$gam)
AIC(model.meanair.jan.ba.7$mer)

model.meanair.jan.ba.6 <- gamm4(air_off ~ s(Basal_Area_6m,perc_broad_6m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.meanair.jan.ba.6$gam)
AIC(model.meanair.jan.ba.6$mer)

model.meanair.jan.ba.5 <- gamm4(air_off ~ s(Basal_Area_5m,perc_broad_5m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.meanair.jan.ba.5$gam)
AIC(model.meanair.jan.ba.5$mer)

model.meanair.jan.ba.4 <- gamm4(air_off ~ s(Basal_Area_4m,perc_broad_4m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.meanair.jan.ba.4$gam)
AIC(model.meanair.jan.ba.4$mer)

# Min air temperature offset warmest month
model.minair.jan.ba.10 <- gamm4(min_off ~ s(Basal_Area_10m,perc_broad_10m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.minair.jan.ba.10$gam)
AIC(model.minair.jan.ba.10$mer)

model.minair.jan.ba.9 <- gamm4(min_off ~ s(Basal_Area_9m,perc_broad_9m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.minair.jan.ba.9$gam)
AIC(model.minair.jan.ba.9$mer)

model.minair.jan.ba.8 <- gamm4(min_off ~ s(Basal_Area_8m,perc_broad_8m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.minair.jan.ba.8$gam)
AIC(model.minair.jan.ba.8$mer)

model.minair.jan.ba.7 <- gamm4(min_off ~ s(Basal_Area_7m,perc_broad_7m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.minair.jan.ba.7$gam)
AIC(model.minair.jan.ba.7$mer)

model.minair.jan.ba.6 <- gamm4(min_off ~ s(Basal_Area_6m,perc_broad_6m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.minair.jan.ba.6$gam)
AIC(model.minair.jan.ba.6$mer)

model.minair.jan.ba.5 <- gamm4(min_off ~ s(Basal_Area_5m,perc_broad_5m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.minair.jan.ba.5$gam)
AIC(model.minair.jan.ba.5$mer)

model.minair.jan.ba.4 <- gamm4(min_off ~ s(Basal_Area_4m,perc_broad_4m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.minair.jan.ba.4$gam)
AIC(model.minair.jan.ba.4$mer)

# Max air temperature offset warmest month
model.maxair.jan.ba.10 <- gamm4(max_off ~ s(Basal_Area_10m,perc_broad_10m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.maxair.jan.ba.10$gam)
AIC(model.maxair.jan.ba.10$mer)

model.maxair.jan.ba.9 <- gamm4(max_off ~ s(Basal_Area_9m,perc_broad_9m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.maxair.jan.ba.9$gam)
AIC(model.maxair.jan.ba.9$mer)

model.maxair.jan.ba.8 <- gamm4(max_off ~ s(Basal_Area_8m,perc_broad_8m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.maxair.jan.ba.8$gam)
AIC(model.maxair.jan.ba.8$mer)

model.maxair.jan.ba.7 <- gamm4(max_off ~ s(Basal_Area_7m,perc_broad_7m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.maxair.jan.ba.7$gam)
AIC(model.maxair.jan.ba.7$mer)

model.maxair.jan.ba.6 <- gamm4(max_off ~ s(Basal_Area_6m,perc_broad_6m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.maxair.jan.ba.6$gam)
AIC(model.maxair.jan.ba.6$mer)

model.maxair.jan.ba.5 <- gamm4(max_off ~ s(Basal_Area_5m,perc_broad_5m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.maxair.jan.ba.5$gam)
AIC(model.maxair.jan.ba.5$mer)

model.maxair.jan.ba.4 <- gamm4(max_off ~ s(Basal_Area_4m,perc_broad_4m) + s(Day) + site + wind + prev_av_temp + prev_av_prec, random = ~ (1|site:Plot), data = tree.temp.a.jan)

summary(model.maxair.jan.ba.4$gam)
AIC(model.maxair.jan.ba.4$mer)
```

